% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/logSt.R
\name{logSt}
\alias{logSt}
\alias{logStInv}
\title{Started Logarithmic Transformation and Its Inverse}
\usage{
logSt(x, base = 10, calib = x, threshold = NULL, mult = 1)

logStInv(x, base = NULL, threshold = NULL)
}
\arguments{
\item{x}{a vector or matrix of data, which is to be transformed}

\item{base}{a positive or complex number: the base with respect to which
logarithms are computed. Defaults to 10. Use=exp(1) for natural log.}

\item{calib}{a vector or matrix of data used to calibrate the
transformation(s), i.e., to determine the constant \eqn{c} needed}

\item{threshold}{constant \eqn{c} that determines the transformation. The
inverse function \code{LogStInv} will look for an attribute named
\code{"threshold"} if the argument is set to \code{NULL}.}

\item{mult}{a tuning constant affecting the transformation of small values,
see \code{Details}.}
}
\value{
the transformed data. The value \eqn{c} used for the transformation
and needed for inverse transformation is returned as
\code{attr(.,"threshold")} and the used base as \code{attr(.,"base")}.
}
\description{
Transforms the data by a log transformation, modifying small and zero
observations such that the transformation is linear for \eqn{x <=
threshold}{x <= threshold} and logarithmic for x > threshold. So the
transformation yields finite values and is continuously differentiable.
}
\details{
In order to avoid \eqn{log(x) = -\infty}{log(x) = -inf} for \eqn{x=0} in
log-transformations there's often a constant added to the variable before
taking the \eqn{log}. This is not always a pleasable strategy. The function
\code{LogSt} handles this problem based on the following ideas: \itemize{
\item The modification should only affect the values for "small" arguments.
\item What "small" is should be determined in connection with the non-zero
values of the original variable, since it should behave well (be
equivariant) with respect to a change in the "unit of measurement". \item The
function must remain monotone, and it should remain (weakly) convex. } These
criteria are implemented here as follows: The shape is determined by a
threshold \eqn{c} at which - coming from above - the log function switches
to a linear function with the same slope at this point.

This is obtained by

\deqn{g(x) = }{g(x)=log_10(x), if x>c, log_10(c) - (c-x)/(c log(10)),
otherwise}\deqn{ \left\{\begin{array}{ll} }{g(x)=log_10(x), if x>c,
log_10(c) - (c-x)/(c log(10)), otherwise}\deqn{ log_{10}(x) &\textup{for }x
\ge c\\ }{g(x)=log_10(x), if x>c, log_10(c) - (c-x)/(c log(10)),
otherwise}\deqn{ log_{10}(c) - \frac{c - x}{c \cdot log(10)} &\textup{for }
x < c }{g(x)=log_10(x), if x>c, log_10(c) - (c-x)/(c log(10)),
otherwise}\deqn{ \end{array}\right. }{g(x)=log_10(x), if x>c, log_10(c) -
(c-x)/(c log(10)), otherwise}

Small values are determined by the threshold \eqn{c}. If not given by the
argument \code{threshold}, it is determined by the quartiles \eqn{q_1} and
\eqn{q_3} of the non-zero data as those smaller than \eqn{c =
\frac{q_1^{1+r}}{q_3^r}}{c=q_1^{1+r}/q_3^r} where \eqn{r} can be set by the
argument \code{mult}. The rationale is, that, for lognormal data, this
constant identifies 2 percent of the data as small.\cr Beyond this limit,
the transformation continues linear with the derivative of the log curve at
this point. \cr

Another idea for choosing the threshold \eqn{c} was: median(x) /
(median(x)/quantile(x, 0.25))^2.9)\cr\cr The function chooses \eqn{log_{10}}
rather than natural logs by default because they can be backtransformed
relatively easily in mind.

A generalized log (see: Rocke 2003) can be calculated in order to stabilize
the variance as: \preformatted{function (x, a) { return(log((x + sqrt(x^2 +
a^2)) / 2)) }}
}
\examples{

dd <- c(seq(0,1,0.1), 5 * 10^rnorm(100, 0, 0.2))
dd <- sort(dd)
r.dl <- logSt(dd)
plot(dd, r.dl, type="l")
abline(v=attr(r.dl, "threshold"), lty=2)

x <- rchisq(df=3, n=100)
# should give 0 (or at least something small):
logStInv(logSt(x)) - x

}
\references{
Rocke, D M, Durbin B (2003): Approximate variance-stabilizing
transformations for gene-expression microarray data, \emph{Bioinformatics}.
22;19(8):966-72.
}
\seealso{
\code{\link{log}}, \code{\link{log10}}
}
\author{
Werner A. Stahel, ETH Zurich \cr slight modifications Andri
Signorell \href{mailto:andri@signorell.net}{andri@signorell.net}
}
\keyword{math}
